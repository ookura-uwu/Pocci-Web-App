<!doctype html>
<html lang="en">
  <head>
	<title>Pocci :: Add Question</title>
	<!-- Required meta tags -->
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

	<!-- Bootstrap CSS -->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css">
	<script src="https://kit.fontawesome.com/e4667790a4.js" crossorigin="anonymous"></script>

	<link rel="stylesheet" href="/styles.css">

    <link rel="icon" type="image/png" href="/images/firebase-logo.png">

  </head>
  <body>

	<div id="wrapper">

        <!-- SIDEBAR -->
		<nav id="sidebar">
			<div class="sidebar-header text-center">
				<div id="sidebar-header-nav bg-dark" style="height: 56px; background-color: #212529;"></div>
				<div class="user-view">
					<div class="background">
						<img src="./firebase-logo.png" class="cover-photo" alt="">
					</div>
				</div>
			</div>
			<ul class="list-unstyled components">
				<span class="text-center">
					<h6>WELCOME,</h6>
					<h5>ADMINISTRATOR</h5>
				</span>
				<hr>
				<li><a href="/"><i class="ml-2 fas fa-tachometer-alt"></i>&nbsp; Dashboard</a></li>
				<li><a href="/users"><i class="ml-2 fas fa-user"></i>&nbsp; User Management</a></li>
				<li><a href="/position" ><i class="fas fa-filter"></i>&nbsp; Positions</a></li>
                <li><a href="/exam-results"><i class="fas fa-question-circle"></i>&nbsp; Exam Results</a></li>
				<li>
					<a class="nav-link" href="#collapseQuestion" id="navbarDropdown" role="button" data-bs-toggle="collapse" aria-controls="collapseQ" aria-expanded="false">
						<i class="ml-2 fas fa-caret-down"></i> &nbsp; Question
					</a>
					<ul class="collapse" id="collapseQuestion" aria-labelledby="navbarDropdown">
						<li class="nav-item"><a class="nav-link" href="/question"><i class="fas fa-minus collapseQuestionIcon"></i> Add Question</a></li>
						<li class="nav-item"><a class="nav-link" href="/view-questions"><i class="fas fa-minus collapseQuestionIcon"></i> View Questions</a></li>
					</ul>
				</li>
			</ul>
		</nav>
		<!-- SIDEBAR END -->
		
		<div id="content">

			<!-- NAVBAR -->
			<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
				<div class="container-fluid">
					<button type="button" id="sidebarCollapse" class="navbar-toggler">
						<i class="navbar-toggler-icon"></i>
					</button>
					<a class="navbar-brand" href="#">Pocci Admin Panel</a>
					<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
						<span class="navbar-toggler-icon"></span>
					</button>
					<div class="collapse navbar-collapse" id="navbarSupportedContent">
						<ul class="navbar-nav ms-auto text-end">
							<li class="nav-item">
								<a class="nav-link" aria-current="page" href="#"><i class="fas fa-user-cog"></i> Settings</a>
							</li>
							<li class="nav-item">
								<a class="nav-link" href="#"><i class="fas fa-sign-out-alt"></i> Logout</a>
							</li>
						</ul>
					</div>
				</div>
			</nav>
			<!-- NAVBAR END -->

            <div id="content-body">
				
				<nav id="breadcrumb-path" aria-label="breadcrumb" role="navigation">
					<ol class="breadcrumb text-muted">
						<li class="breadcrumb-item"><a href="/">Home</a></li>
                        <li class="breadcrumb-item">Question</li>
                        <li class="breadcrumb-item"><a href="#">Question Information</a></li>
					</ol>
				</nav>

				<div class="card pmd-card">
					
					<div class="card-body">
						<h2 class="card-title" id="p-title">Add Question</h2>
						<div class="dropdown-divider"></div>

                        <div class="row mb-3">
                            <div class="col-sm-12 col-md-6 col-lg-5">
                                <label for="category-select">Choose Category</label>
                                <select id="category-select" class="form-select mt-1">
                                    <option disabled selected>Choose Category</option>
                                </select>
                            </div>
                        </div>

                        <div class="row mb-4">
                            <div class="col-sm-12 col-md-10 col-lg-6">
                                <label for="questionInput">Question:</label>
                                <div class="form-floating mt-1">
                                    <textarea class="form-control" id="questionInput" placeholder="Enter Question"></textarea>
                                    <label for="questionInput">Enter Question</label>
                                </div>
                            </div>
                        </div>

                        <h5>Choices</h5>
                        <div class="dropdown-divider"></div>
                        <div class="row mb-3">
                            <div class="col-sm-12 col-md-12 col-lg-5 mb-3">
                                <div class="input-group">
                                    <span class="input-group-text" id="optionA">Enter Option A</span>
                                    <input type="text" class="form-control" id="option1" aria-label="OptionA" aria-describedby="optionA">
                                </div>
                            </div>
                            <div class="col-sm-12 col-md-12 col-lg-5">
                                <div class="input-group">
                                    <span class="input-group-text" id="optionB">Enter Option B</span>
                                    <input type="text" class="form-control" id="option2" aria-label="OptionB" aria-describedby="optionB">
                                </div>
                            </div>
                        </div>
                        <div class="row mb-5">
                            <div class="col-sm-12 col-md-12 col-lg-5 mb-3">
                                <div class="input-group">
                                    <span class="input-group-text" id="optionC">Enter Option C</span>
                                    <input type="text" class="form-control" id="option3" aria-label="OptionC" aria-describedby="optionC">
                                </div>
                            </div>
                            <div class="col-sm-12 col-md-12 col-lg-5">
                                <div class="input-group">
                                    <span class="input-group-text" id="optionD">Enter Option D</span>
                                    <input type="text" class="form-control" id="option4" aria-label="OptionD" aria-describedby="optionD">
                                </div>
                            </div>
                        </div>

                        <div class="dropdown-divider"></div>

                        <div class="row mb-3">
                            <div class="col-sm-12 col-md-8 col-lg-6 col-xl-5">
                                <div class="input-group">
                                    <span class="input-group-text" id="correctAnswer">Enter Correct Answer</span>
                                    <input type="text" class="form-control" id="correct-answer" arial-label="CorrectAnswer" aria-describedby="correctAnswer">
                                </div>
                            </div>
                        </div>
                        <div class="row mb-5">
                            <div class="col-sm-12 col-md-8 col-lg-6 col-xl-5">
                                <div class="input-group">
                                    <span class="input-group-text" id="q-explanation">Enter Explanation</span>
                                    <input type="text" class="form-control" id="explanation" arial-label="Explanation" aria-describedby="q-explanation">
                                </div>
                            </div>
                        </div>

                        <div class="d-grid d-md-block">
                            <button class="btn btn-primary col-md-6 col-lg-2" id="save-btn">Save</button>
                        </div>
					</div>
				</div>
				
                <!-- Toast for Success Add-->
                <div class="toast-container position-absolute start-50 translate-middle-x">
                    <div class="toast align-items-center border-0 bg-dark" id="toast-add-success" role="alert" aria-live="assertive" aria-atomic="true">
                        <div class="d-flex">
                            <div class="toast-body text-muted">
                                <img src="/firebase-logo.png" alt="" width="25">
                                <span id="result-success">New Question Added Successfully!</span>
                            </div>
                            <button class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
                        </div>
                    </div>
                </div>

                <!-- Toast for Failed Add-->
                <div class="toast-container position-absolute start-50 translate-middle-x">
                    <div class="toast align-items-center border-0 bg-dark" id="toast-add-fail" role="alert" aria-live="assertive" aria-atomic="true">
                        <div class="d-flex">
                            <div class="toast-body text-muted">
                                <img src="/firebase-logo.png" alt="" width="25">
                                Please Fill-In All Fields!
                            </div>
                            <button class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
                        </div>
                    </div>
                </div>

                <!-- Toast for Failed Add-->
                <div class="toast-container position-absolute start-50 translate-middle-x">
                    <div class="toast align-items-center border-0 bg-dark" id="toast-add-fail2" role="alert" aria-live="assertive" aria-atomic="true">
                        <div class="d-flex">
                            <div class="toast-body text-muted">
                                <img src="/firebase-logo.png" alt="" width="25">
                                Please Select A Category!
                            </div>
                            <button class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
                        </div>
                    </div>
                </div>
                
			</div>


		</div>
	</div>

    <div class="overlay"></div>
	  
	<!-- Optional JavaScript -->
	<!-- jQuery first, then Popper.js, then Bootstrap JS -->
	<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js"></script>
    
     <!-- Firebase scripts -->
	<script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-app.js"></script>
	<script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-database.js"></script>
    
    <script src="https://unpkg.com/dexie@latest/dist/dexie.js"></script>

    <script src="/firebase.js"></script>

    <script src="/scripts.js"></script>

	<script>

        var select = document.getElementById('category-select')
        var options = []
        let url = window.location.href;

        database.ref('/Positions/').on('value', function(snapshot) {
            let items = []
            snapshot.forEach(function(ds) {
                let elem = document.createElement('option')
                elem.text = ds.child('Position').val()
                select.appendChild(elem)
            })
        })

        $('button#save-btn').on('click', function() {
            if ($('#save-btn').text() == 'Save') {
                let getPosition = document.getElementById('category-select')
                let position = getPosition.options[getPosition.selectedIndex].text
                let question = $('#questionInput').val()
                let option1 = $('#option1').val()
                let option2 = $('#option2').val()
                let option3 = $('#option3').val()
                let option4 = ($('#option4').val() == '' ? 'None' : $('#option4').val())
                let correctAnswer = $('#correct-answer').val()
                let explanation = ($('#explanation').val() == '' ? 'None' : $('#explanation').val())

                let questionsRef = database.ref('/Questionnaires/')

                // Create a new ref and save data to it in one step
                var newQuestion = questionsRef.push()
                
                if (question == '' || option1 == '' || option2 == '' || option3 == '' || correctAnswer == '') {
                    let myToast = document.getElementById('toast-add-fail')
                    let bsToast = new bootstrap.Toast(myToast)
                    bsToast.show()
                } else {
                    if (position != 'Choose Category') {
                        questionsRef.child(newQuestion.key).set({
                            KeyID: newQuestion.key,
                            Question: question,
                            Option1: option1,
                            Option2: option2,
                            Option3: option3,
                            Option4: option4,
                            CorrectAnswer: correctAnswer,
                            Explanation: explanation,
                            Position: position
                        })

                        let myToast = document.getElementById('toast-add-success')
                        let bsToast = new bootstrap.Toast(myToast)
                        bsToast.show()

                        setTimeout(function() {
                            location.reload()
                        }, 1000)
                    } else {
                        let myToast = document.getElementById('toast-add-fail2')
                        let bsToast = new bootstrap.Toast(myToast)
                        bsToast.show()
                    }
                }
            } else if ($('#save-btn').text() == 'Update') {
                if (url.indexOf('?key=') != -1) { 

                    let queryString = window.location.search
                    let urlParams = new URLSearchParams(queryString)
                    let key = urlParams.get('key')

                    let getPosition = document.getElementById('category-select')
                    let position = getPosition.options[getPosition.selectedIndex].text
                    let question = $('#questionInput').val()
                    let option1 = $('#option1').val()
                    let option2 = $('#option2').val()
                    let option3 = $('#option3').val()
                    let option4 = ($('#option4').val() == '' ? 'None' : $('#option4').val())
                    let correctAnswer = $('#correct-answer').val()
                    let explanation = ($('#explanation').val() == '' ? 'None' : $('#explanation').val())

                    let questionsRef = database.ref('/Questionnaires/')

                    // Create a new ref and save data to it in one step
                    var newQuestion = questionsRef.push()
                    
                    if (question == '' || option1 == '' || option2 == '' || option3 == '' || correctAnswer == '') {
                        let myToast = document.getElementById('toast-add-fail')
                        let bsToast = new bootstrap.Toast(myToast)
                        bsToast.show()
                    } else {
                        if (position != 'Choose Category') {
                            questionsRef.child(key).update({
                                Question: question,
                                Option1: option1,
                                Option2: option2,
                                Option3: option3,
                                Option4: option4,
                                CorrectAnswer: correctAnswer,
                                Explanation: explanation,
                                Position: position
                            })

                            $('#result-success').text('Question Updated Successfully!')
                            let myToast = document.getElementById('toast-add-success')
                            let bsToast = new bootstrap.Toast(myToast)
                            bsToast.show()

                            setTimeout(function() {
                                location.reload()
                            }, 1000)
                        } else {
                            let myToast = document.getElementById('toast-add-fail2')
                            let bsToast = new bootstrap.Toast(myToast)
                            bsToast.show()
                        }
                    }
                }
            }
        })

        if (url.indexOf('?key=') != -1) {
            document.title = 'Pocci :: Edit Question'
            $('#p-title').text('Edit Question')
            $('#save-btn').text('Update')
            let queryString = window.location.search
            let urlParams = new URLSearchParams(queryString)
            let key = urlParams.get('key')

            database.ref('/Questionnaires/').child(key).on('value', function(snapshot) {
                let qKey = snapshot.child('KeyID').val()
                let question = snapshot.child('Question').val()
                let position = snapshot.child('Position').val()
                let option1 = snapshot.child('Option1').val()
                let option2 = snapshot.child('Option2').val()
                let option3 = snapshot.child('Option3').val()
                let option4 = snapshot.child('Option4').val()
                let answer = snapshot.child('CorrectAnswer').val()
                let explanation = snapshot.child('Explanation').val()

                let i = 0
                $('#category-select > option').each(function() {
                    if (this.text == position) {
                        document.getElementById('category-select').options.selectedIndex = i
                    }

                    i++
                })

                $('#questionInput').val(question)
                $('#option1').val(option1)
                $('#option2').val(option2)
                $('#option3').val(option3)
                $('#option4').val(option4)
                $('#correct-answer').val(answer)
                $('#explanation').val(explanation)

            })
        } else {
            
        }

	</script>
  </body>
</html>